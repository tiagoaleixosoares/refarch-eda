<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kafka Producers"><meta name=author content="Jerome Boyer"><link href=https://ibm-cloud-architecture.github.com/refarch-eda/technology/kafka-producers/ rel=canonical><link href=../mq/ rel=prev><link href=../kafka-consumers/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>Kafka Producers - IBM Automation - Event-driven Solution - Sharing knowledge</title><link rel=stylesheet href=../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#understanding-kafka-producers class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-header__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM Automation - Event-driven Solution - Sharing knowledge </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kafka Producers </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-nav__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> IBM Automation - Event-driven Solution - Sharing knowledge </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> <span class=md-ellipsis> What's new </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Introduction </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/reference-architecture/ class=md-nav__link> <span class=md-ellipsis> Reference Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/usecases/ class=md-nav__link> <span class=md-ellipsis> Business Use Cases </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/target-audiences/ class=md-nav__link> <span class=md-ellipsis> Target Audiences </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Learning Journey </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Learning Journey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../journey/101/ class=md-nav__link> <span class=md-ellipsis> Get started (101 content) </span> </a> </li> <li class=md-nav__item> <a href=../../journey/201/ class=md-nav__link> <span class=md-ellipsis> Deeper dive (201 content) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/terms-and-definitions/ class=md-nav__link> <span class=md-ellipsis> Terms & Definitions </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/integration/ class=md-nav__link> <span class=md-ellipsis> Agile Integration </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/events-versus-messages/ class=md-nav__link> <span class=md-ellipsis> Event streaming versus Queuing </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/fit-to-purpose/ class=md-nav__link> <span class=md-ellipsis> Fit for purpose </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/model/ class=md-nav__link> <span class=md-ellipsis> Devising the data models </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/flow-architectures/ class=md-nav__link> <span class=md-ellipsis> Flow Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/service-mesh/ class=md-nav__link> <span class=md-ellipsis> Service mesh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Advantages of EDA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advantages of EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advantages/microservice/ class=md-nav__link> <span class=md-ellipsis> Microservice decoupling </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/reactive/ class=md-nav__link> <span class=md-ellipsis> Reactive systems </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/resiliency/ class=md-nav__link> <span class=md-ellipsis> Resiliency </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/scalability/ class=md-nav__link> <span class=md-ellipsis> Scalability </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Patterns in EDA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Patterns in EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/intro/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> <span class=md-ellipsis> Saga </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> <span class=md-ellipsis> Dead Letter Queue </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/topic-replication/ class=md-nav__link> <span class=md-ellipsis> Topic Replication </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/data-pipeline/ class=md-nav__link> <span class=md-ellipsis> Data Intensive App </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/realtime-analytics/ class=md-nav__link> <span class=md-ellipsis> Near real-time analytics </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> <span class=md-ellipsis> API management </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cep/ class=md-nav__link> <span class=md-ellipsis> Situational decision </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/domain-driven-design/ class=md-nav__link> <span class=md-ellipsis> Domain-Driven Design </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/data-intensive/ class=md-nav__link> <span class=md-ellipsis> Data Intensive App Development </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/data-lineage/ class=md-nav__link> <span class=md-ellipsis> Data lineage </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Technology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=true> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kafka-overview/ class=md-nav__link> <span class=md-ellipsis> Kafka Overview </span> </a> </li> <li class=md-nav__item> <a href=../event-streams/ class=md-nav__link> <span class=md-ellipsis> Event Streams </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/demo/ class=md-nav__link> <span class=md-ellipsis> Event Streams Demo Script </span> </a> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> <span class=md-ellipsis> Kafka FAQ </span> </a> </li> <li class=md-nav__item> <a href=../mq/ class=md-nav__link> <span class=md-ellipsis> MQ in EDA context </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kafka Producers </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kafka Producers </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#understanding-kafka-producers class=md-nav__link> <span class=md-ellipsis> Understanding Kafka Producers </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations class=md-nav__link> <span class=md-ellipsis> Design considerations </span> </a> </li> <li class=md-nav__item> <a href=#typical-producer-code-structure class=md-nav__link> <span class=md-ellipsis> Typical producer code structure </span> </a> </li> <li class=md-nav__item> <a href=#kafka-useful-producer-apis class=md-nav__link> <span class=md-ellipsis> Kafka useful Producer APIs </span> </a> <nav class=md-nav aria-label="Kafka useful Producer APIs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#properties-to-consider class=md-nav__link> <span class=md-ellipsis> Properties to consider </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-producer-guidances class=md-nav__link> <span class=md-ellipsis> Advanced producer guidances </span> </a> <nav class=md-nav aria-label="Advanced producer guidances"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-support-exactly-once-delivery class=md-nav__link> <span class=md-ellipsis> How to support exactly once delivery </span> </a> </li> <li class=md-nav__item> <a href=#code-examples class=md-nav__link> <span class=md-ellipsis> Code Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#more-readings class=md-nav__link> <span class=md-ellipsis> More readings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../kafka-consumers/ class=md-nav__link> <span class=md-ellipsis> Kafka Consumers </span> </a> </li> <li class=md-nav__item> <a href=../avro-schemas/ class=md-nav__link> <span class=md-ellipsis> Avro Schema </span> </a> </li> <li class=md-nav__item> <a href=../advanced-kafka/ class=md-nav__link> <span class=md-ellipsis> Advanced Concepts </span> </a> </li> <li class=md-nav__item> <a href=../kafka-streams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams </span> </a> </li> <li class=md-nav__item> <a href=../kafka-connect/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=../event-streams/es-maas/security/ class=md-nav__link> <span class=md-ellipsis> Kafka security </span> </a> </li> <li class=md-nav__item> <a href=../kafka-monitoring/ class=md-nav__link> <span class=md-ellipsis> Kafka Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../kafka-mirrormaker/ class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 </span> </a> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../flink/ class=md-nav__link> <span class=md-ellipsis> Apache Flink </span> </a> </li> <li class=md-nav__item> <a href=../spring/ class=md-nav__link> <span class=md-ellipsis> Spring cloud </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../use-cases/gitops/ class=md-nav__link> <span class=md-ellipsis> Event-driven solution GitOps </span> </a> </li> <li class=md-nav__item> <a href=../event-streams/es-cp4i/ class=md-nav__link> <span class=md-ellipsis> Deploy Event-Streams </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-s3/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - S3 </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-cos/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - COS </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-jdbc/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - jdbc </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-mq/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - MQ </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/connect-rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - Rabbitmq </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/kafka-streams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams labs </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/db2-debezium/ class=md-nav__link> <span class=md-ellipsis> DB2 - CDC Debezium - Outbox </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/kafka-mm2/ class=md-nav__link> <span class=md-ellipsis> Mirror maker 2 labs </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/schema-registry-on-cloud/ class=md-nav__link> <span class=md-ellipsis> Schema registry ES on Cloud </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/schema-registry-on-ocp/ class=md-nav__link> <span class=md-ellipsis> Schema registry </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/monitoring-on-cloud/ class=md-nav__link> <span class=md-ellipsis> Monitoring ES on Cloud </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/monitoring-on-ocp/ class=md-nav__link> <span class=md-ellipsis> Monitoring ES </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Scenarios </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Scenarios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ class=md-nav__link> <span class=md-ellipsis> Reefer Shipment Solution </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/vaccine-solution-main/ class=md-nav__link> <span class=md-ellipsis> Vaccine at Scale </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-rt-inventory-gitops class=md-nav__link> <span class=md-ellipsis> Near real-time Inventory </span> </a> </li> <li class=md-nav__item> <a href=../../scenarios/saga-orchestration/ class=md-nav__link> <span class=md-ellipsis> SAGA with MQ Orchestration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../additional-reading/ class=md-nav__link> <span class=md-ellipsis> Additional reading </span> </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> <span class=md-ellipsis> Contribute to this Site </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#understanding-kafka-producers class=md-nav__link> <span class=md-ellipsis> Understanding Kafka Producers </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations class=md-nav__link> <span class=md-ellipsis> Design considerations </span> </a> </li> <li class=md-nav__item> <a href=#typical-producer-code-structure class=md-nav__link> <span class=md-ellipsis> Typical producer code structure </span> </a> </li> <li class=md-nav__item> <a href=#kafka-useful-producer-apis class=md-nav__link> <span class=md-ellipsis> Kafka useful Producer APIs </span> </a> <nav class=md-nav aria-label="Kafka useful Producer APIs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#properties-to-consider class=md-nav__link> <span class=md-ellipsis> Properties to consider </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-producer-guidances class=md-nav__link> <span class=md-ellipsis> Advanced producer guidances </span> </a> <nav class=md-nav aria-label="Advanced producer guidances"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-to-support-exactly-once-delivery class=md-nav__link> <span class=md-ellipsis> How to support exactly once delivery </span> </a> </li> <li class=md-nav__item> <a href=#code-examples class=md-nav__link> <span class=md-ellipsis> Code Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#more-readings class=md-nav__link> <span class=md-ellipsis> More readings </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Kafka Producers</h1> <h2 id=understanding-kafka-producers>Understanding Kafka Producers<a class=headerlink href=#understanding-kafka-producers title="Permanent link">&para;</a></h2> <p>A producer is a thread safe kafka client API that publishes records to the cluster. It uses buffers, thread pool, and serializers to send data. They are stateless: the consumers is responsible to manage the offsets of the message they read. When the producer connects via the initial bootstrap connection, it gets the metadata about the topic - partition and the leader broker to connect to. The assignment of messages to partition is done following different algorithms: round-robin if there is no key specified, using the hash code of the key, or custom defined.</p> <p>We recommend reading <a href=https://ibm.github.io/event-streams/about/producing-messages/ >IBM Event streams producer guidelines</a> to understand how producers work with its configuration parameters.</p> <h2 id=design-considerations>Design considerations<a class=headerlink href=#design-considerations title="Permanent link">&para;</a></h2> <p>When developing a record producer you need to assess the followings:</p> <ul> <li>What is the event payload to send? Is is a root aggregate, as defined in domain driven design, with value objects? Does it need to be kept in sequence to be used as event sourcing? or order does not matter? Remember that when order is important, messages need to go to the same topic. When multiple partitions are used, the messages with the same key will go to the same partition to guaranty the order. See related discussions <a href=https://www.confluent.io/blog/put-several-event-types-kafka-topic/ >from Martin Kleppmann on confluent web site</a>. Also to be exhaustive, it is possible to get a producer doing retries that could generate duplicate records as acknowledges may take time to come: within a batch of n records, if the producer did not get all the n acknowledges on time, it may resend the batch. This is where 'idempotence' becomes important (see later section).</li> <li>Is there a strong requirement to manage the schema definition? If using one topic to manage all events about a business entity, then be sure to support a flexible <a href=https://avro.apache.org/docs/1.8.1/spec.html>avro schema</a>.</li> <li>What is the expected throughput to send events? Event size * average throughput combined with the expected latency help to compute buffer size. By default, the buffer size is set at 32Mb, but can be configured with <code>buffer.memory</code> property. (See <a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/clients/producer/ProducerConfig.html>producer configuration API</a>)</li> <li>Can the producer batches events together to send them in batch over one send operation? By design kafka producers batch events.</li> <li>Is there a risk for loosing communication? Tune the RETRIES_CONFIG and buffer size, and ensure to have at least 3 or even better 5, brokers within the cluster to maintain quorum in case of one failure. The client API is implemented to support reconnection.</li> <li> <p>When deploying kafka on Kubernetes, it is important to proxy the broker URLs with a proxy server outside of kubernetes. The HAProxy needs to scale, and as the kafka traffic may be important, it may make sense to have a dedicated HAProxy for clients to brokers traffic.</p> </li> <li> <p>Assess <em>exactly once</em> delivery requirement. Look at idempotent producer: retries will not introduce duplicate records (see <a href=#how-to-support-exactly-once-delivery>section</a> below).</p> </li> <li>Partitions help to scale the consumer processing of messages, but it also helps the producer to be more efficient as it can send message in parallel to different partition.</li> <li>Where the event timestamp comes from? Should the producer send operation set it or is it loaded from external data? Remember that <code>LogAppendTime</code> is considered to be processing time, and <code>CreateTime</code> is considered to be event time.</li> </ul> <h2 id=typical-producer-code-structure>Typical producer code structure<a class=headerlink href=#typical-producer-code-structure title="Permanent link">&para;</a></h2> <p>The producer code, using java or python API, does the following steps:</p> <ul> <li>define producer properties</li> <li>create a producer instance</li> <li>Connect to the bootstrap URL, get a broker leader</li> <li>send event records and get resulting metadata.</li> </ul> <p>Producers are thread safe. The send() operation is asynchronous and returns immediately once record has been stored in the buffer of records, and it is possible to add a callback to process the broker acknowledgements.</p> <p><a href=https://github.com/ibm-cloud-architecture/eda-quickstarts/tree/main/quarkus-kafka-producer>Here is an example of producer code from the quick start.</a></p> <h2 id=kafka-useful-producer-apis>Kafka useful Producer APIs<a class=headerlink href=#kafka-useful-producer-apis title="Permanent link">&para;</a></h2> <p>Here is a list of common API to use in your producer and consumer code.</p> <ul> <li><a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html>KafkaProducer</a> A Kafka client that publishes records to the Kafka cluster. The send method is asynchronous. A producer is thread safe so we can have per topic to interface.</li> <li><a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/clients/producer/ProducerRecord.html>ProducerRecord</a> to be published to a topic</li> <li><a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/clients/producer/RecordMetadata.html>RecordMetadata</a> metadata for a record that has been acknowledged by the server.</li> </ul> <h3 id=properties-to-consider>Properties to consider<a class=headerlink href=#properties-to-consider title="Permanent link">&para;</a></h3> <p>The following properties are helpful to tune at each topic and producer and will vary depending on the requirements: </p> <table> <thead> <tr> <th>Properties</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>BOOTSTRAP_SERVERS_CONFIG</td> <td>A comma-separated list of host:port values for all the brokers deployed. So producer may use any brokers</td> </tr> <tr> <td>KEY_SERIALIZER_CLASS_CONFIG and VALUE_SERIALIZER_CLASS_CONFIG</td> <td>convert the keys and values into byte arrays. Using default String serializer should be a good solution for Json payload. For streaming app, use customer serializer.</td> </tr> <tr> <td>ACKS_CONFIG</td> <td>specifies the minimum number of acknowledgments from a broker that the producer will wait for before considering a record send completed. Values = all, 0, and 1. 0 is for fire and forget.</td> </tr> <tr> <td>RETRIES_CONFIG</td> <td>specifies the number of times to attempt to resend a batch of events.</td> </tr> <tr> <td>ENABLE_IDEMPOTENCE_CONFIG</td> <td>Set to true, the number of retries will be maximized, and the acks will be set to <code>All</code>.</td> </tr> <tr> <td>TRANSACTION_ID</td> <td>A unique identifier for a producer. In case of multiple producer instances, a same ID will mean a second producers can commit the transaction. Epoch number, linked to the process ID, avoid having two producers doing this commit. If no transaction ID is specified, the transaction will be valid within a single session.</td> </tr> </tbody> </table> <h2 id=advanced-producer-guidances>Advanced producer guidances<a class=headerlink href=#advanced-producer-guidances title="Permanent link">&para;</a></h2> <h3 id=how-to-support-exactly-once-delivery>How to support exactly once delivery<a class=headerlink href=#how-to-support-exactly-once-delivery title="Permanent link">&para;</a></h3> <p>Knowing that exactly once delivery is one of the hardest problems to solve in distributed systems, how kafka does it?. Broker can fail or a network may respond slowly while a producer is trying to send events.</p> <p>Producer can set acknowledge level to control the delivery semantic to ensure not loosing data. The following semantic is supported:</p> <ul> <li><strong>At least once</strong>: means the producer set <code>ACKS=1</code> and get an acknowledgement message when the message sent, has been written to at least one time in the cluster (assume replicas = 3). If the ack is not received, the producer may retry, which may generate duplicate records in case the broker stops after saving to the topic and before sending back the acknowledgement message.</li> <li><strong>At most semantic</strong>: means the producer will not do retry in case of no acknowledge received. It may create log and compensation, but the message may be lost.</li> <li><strong>Exactly once</strong> means even if the producer sends the message twice the system will send only one message to the consumer. Once the consumer commits the read offset, it will not receive the message again, even if it restarts. Consumer offset needs to be in sync with produced event.</li> </ul> <p>With <code>acks = 1</code> it is possible to lose messages, as illustrated in the following diagram, where new messages were not replicated yet, and ack was already sent back to the producer. Losing messages will depend if a replica is taking the leader position or not, or if the failed broker goes back online before replicas election but has no fsynch to the disk before the crash. </p> <p><img alt src=images/ack-1-msg-lost.gif></p> <p>To avoid that we need to have <code>ack=-1</code>, three replicas and in-sync-replica=2. Replicated messages are acknowledged, when broker fails, a new leader is selected with the replicated messagesm it becomes the partition leader and others start to replicate from him. Producer reconnect to the partition leader.</p> <p><img alt src=images/ack-all.gif></p> <p>Here is an example of cluster configuration with default set for all topic</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=nt>strimziOverrides</span><span class=p>:</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>        </span><span class=nt>kafka</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>            </span><span class=nt>config</span><span class=p>:</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>                </span><span class=nt>default.replication.factor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>                </span><span class=nt>min.insync.replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div> <p>Or at the topic level:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KafkaTopic</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-store.inventory</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rt-inventory-dev</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=nt>eventstreams.ibm.com/cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class=nt>partitions</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=nt>min.insync.replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div> <p>At the best case scenario, with a replica factor set to 3, a broker responding on time to the producer, and with a consumer committing its offset and reading from the last committed offset it is possible to get only one message end to end.</p> <p><img alt src=images/exactly-one-0.png></p> <p>Sometime the brokers will not send acknowledge in expected time, and the producer may decide to send the records again, generating duplicate...</p> <p><img alt src=images/exactly-one-1.png></p> <p>To avoid duplicate message at the broker level, when acknowledge is set to ALL, the producer can also set idempotence flag: ENABLE_IDEMPOTENCE_CONFIG = true. With the idempotence property, the record sent, has a sequence number and a producer id, so that the broker keeps the last sequence number per producer and per partition. If a message is received with a lower sequence number, it means a producer is doing some retries on record already processed, so the broker will drop it, to avoid having duplicate records per partition. If the id is greater than current id known by the broker, the broker will create an OutOfSequence exception, which may be fatal as records may have been lost.</p> <p><img alt="Exactly once" src=images/exactly-one-2.png></p> <p>The sequence number is persisted in a log so even in case of broker leader failure, the new leader will have a good view of the states of the system.</p> <blockquote> <p>The replication mechanism guarantees that, when a message is written to the leader replica, it will be replicated to all available replicas. As soon as you want to get acknowledge of all replicates, it is obvious to set idempotence to true. It does not impact performance.</p> </blockquote> <p>To add to this discussion, as topic may have multiple partitions, idempotent producers do not provide guarantees for writes across multiple Topic-Partition. For that Kafka supports atomic writes to all partitions, so that all records are saved or none of them are visible to consumers. This transaction control is done by using the producer transactional API, and a transacitional protocol with coordinator and control message. Here is an example of such configuration that can be done in a producer constructor method:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>producerProps</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;enable.idempotence&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=p>);</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>producerProps</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;transactional.id&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;prod-1&quot;</span><span class=p>);</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>kafkaProducer</span><span class=p>.</span><span class=na>initTransactions</span><span class=p>()</span>
</code></pre></div> <p><code>initTransactions()</code> registers the producer with the broker as one that can use transaction, identifying it by its <code>transactional.id</code> and a sequence number, or epoch. Epoch is used to avoid an old producer to commit a transaction while a new producer instance was created for that and continues its work.</p> <p>Kafka streams with consume-process-produce loop requires transaction and exactly once. Even commiting its read offset is part of the transaction. So Producer API has a <a href=https://kafka.apache.org/32/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html#sendOffsetsToTransaction-java.util.Map-org.apache.kafka.clients.consumer.ConsumerGroupMetadata->sendOffsetsToTransaction method</a>.</p> <p>See the <a href=https://cwiki.apache.org/confluence/display/KAFKA/KIP-98+-+Exactly+Once+Delivery+and+Transactional+Messaging>KIP 98 for details.</a></p> <p>In case of multiple partitions, the broker will store a list of all updated partitions for a given transaction.</p> <p>To support transaction a transaction coordinator keeps its states into an internal topic (TransactionLog). Control messages are added to the main topic but never exposed to the 'user', so that consumers have the knowledge if a transaction is committed or not. </p> <p>See the <a href=https://github.com/ibm-cloud-architecture/refarch-kc-order-ms/blob/53bbb8cdeac413883ca2ccf521eb0797a43f45a3/order-command-ms/src/main/java/ibm/gse/orderms/infrastructure/kafka/OrderCommandProducer.java#L46>code in order command</a> microservice.</p> <p>The consumer is also interested to configure the reading of the transactional messages by defining the isolation level. Consumer waits to read transactional messages until the associated transaction has been committed. Here is an example of consumer code and configuration</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>consumerProps</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;enable.auto.commit&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;false&quot;</span><span class=p>);</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>consumerProps</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;isolation.level&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;read_committed&quot;</span><span class=p>);</span>
</code></pre></div> <p>With <code>read_committed</code>, no message that was written to the input topic in the same transaction will be read by this consumer until message replicas are all written.</p> <p>In consume-process-produce loop, producer commits its offset with code, and specifies the last offset to read.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>offsetsToCommit</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>partition</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OffsetAndMetadata</span><span class=p>(</span><span class=n>offset</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>))</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>producer</span><span class=p>.</span><span class=na>sendOffsetsToTransaction</span><span class=p>(</span><span class=n>offsetsToCommit</span><span class=p>,</span><span class=w> </span><span class=s>&quot;consumer-group-id&quot;</span><span class=p>);</span>
</code></pre></div> <p>The producer then commits the transaction.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>try</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=n>kafkaProducer</span><span class=p>.</span><span class=na>beginTransaction</span><span class=p>();</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=n>ProducerRecord</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ProducerRecord</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>ApplicationConfig</span><span class=p>.</span><span class=na>ORDER_COMMAND_TOPIC</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=n>Future</span><span class=o>&lt;</span><span class=n>RecordMetadata</span><span class=o>&gt;</span><span class=w> </span><span class=n>send</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kafkaProducer</span><span class=p>.</span><span class=na>send</span><span class=p>(</span><span class=n>record</span><span class=p>,</span><span class=w> </span><span class=n>callBackFunction</span><span class=p>);</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=n>kafkaProducer</span><span class=p>.</span><span class=na>commitTransaction</span><span class=p>();</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>KafkaException</span><span class=w> </span><span class=n>e</span><span class=p>){</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=n>kafkaProducer</span><span class=p>.</span><span class=na>abortTransaction</span><span class=p>();</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=p>}</span>
</code></pre></div> <p>There is an interesting <a href=https://www.baeldung.com/kafka-exactly-once>article</a> from the Baeldung team about exactly once processing in kafka with code example which we have re-used to implement the order processing in our <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ >Reefer Container Shipment reference application</a> and explained <a href=https://ibm-cloud-architecture.github.io/refarch-kc/orders/order/ >here</a></p> <h3 id=code-examples>Code Examples<a class=headerlink href=#code-examples title="Permanent link">&para;</a></h3> <ul> <li><a href=https://github.com/ibm-cloud-architecture/refarch-kc-order-ms>Order management with CQRS in Java</a></li> <li><a href=https://github.com/ibm-cloud-architecture/eda-quickstart>EDA quickstart Quarkus Producer API</a></li> <li><a href=https://github.com/ibm-cloud-architecture/refarch-kc-container-ms>Springboot with kafka template</a></li> <li><a href=https://github.com/jbcodeforce/microprofile-event-driven-microservice-template/ >Event driven microservice template</a></li> </ul> <h2 id=more-readings>More readings<a class=headerlink href=#more-readings title="Permanent link">&para;</a></h2> <ul> <li><a href=http://cloudurable.com/blog/kafka-tutorial-kafka-producer-advanced-java-examples/index.html>Creating advanced kafka producer in java - Cloudurable</a></li> <li><a href=https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/ >Confluent blog: Exactly-once Semantics are Possible: Here’s How Kafka Does it</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2022 IBM </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ibm-cloud-architecture target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/agileitarchitecture target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.1e8ae164.min.js></script> </body> </html>