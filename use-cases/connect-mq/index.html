<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Apache Kafka to IBM MQ with Kafka Connector labs"><meta name=author content="Jerome Boyer"><link href=https://ibm-cloud-architecture.github.com/refarch-eda/use-cases/connect-mq/ rel=canonical><link href=../connect-jdbc/ rel=prev><link href=../connect-rabbitmq/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>Kafka to IBM MQ with Kafka Connector - IBM Automation - Event-driven Solution - Sharing knowledge</title><link rel=stylesheet href=../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#audience class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-header__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> IBM Automation - Event-driven Solution - Sharing knowledge </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Kafka to IBM MQ with Kafka Connector </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="IBM Automation - Event-driven Solution - Sharing knowledge" class="md-nav__button md-logo" aria-label="IBM Automation - Event-driven Solution - Sharing knowledge" data-md-component=logo> <img src=../../images/es-icon.png alt=logo> </a> IBM Automation - Event-driven Solution - Sharing knowledge </label> <div class=md-nav__source> <a href=https://github.com/ibm-cloud-architecture/refarch-eda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> ibm-cloud-architecture/refarch-eda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> <span class=md-ellipsis> What's new </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Introduction </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/reference-architecture/ class=md-nav__link> <span class=md-ellipsis> Reference Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/usecases/ class=md-nav__link> <span class=md-ellipsis> Business Use Cases </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/target-audiences/ class=md-nav__link> <span class=md-ellipsis> Target Audiences </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Learning Journey </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Learning Journey </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../journey/101/ class=md-nav__link> <span class=md-ellipsis> Get started (101 content) </span> </a> </li> <li class=md-nav__item> <a href=../../journey/201/ class=md-nav__link> <span class=md-ellipsis> Deeper dive (201 content) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/terms-and-definitions/ class=md-nav__link> <span class=md-ellipsis> Terms & Definitions </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/integration/ class=md-nav__link> <span class=md-ellipsis> Agile Integration </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/events-versus-messages/ class=md-nav__link> <span class=md-ellipsis> Event streaming versus Queuing </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/fit-to-purpose/ class=md-nav__link> <span class=md-ellipsis> Fit for purpose </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/model/ class=md-nav__link> <span class=md-ellipsis> Devising the data models </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/flow-architectures/ class=md-nav__link> <span class=md-ellipsis> Flow Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/service-mesh/ class=md-nav__link> <span class=md-ellipsis> Service mesh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Advantages of EDA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advantages of EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advantages/microservice/ class=md-nav__link> <span class=md-ellipsis> Microservice decoupling </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/reactive/ class=md-nav__link> <span class=md-ellipsis> Reactive systems </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/resiliency/ class=md-nav__link> <span class=md-ellipsis> Resiliency </span> </a> </li> <li class=md-nav__item> <a href=../../advantages/scalability/ class=md-nav__link> <span class=md-ellipsis> Scalability </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Patterns in EDA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Patterns in EDA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../patterns/intro/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/event-sourcing/ class=md-nav__link> <span class=md-ellipsis> Event Sourcing </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cqrs/ class=md-nav__link> <span class=md-ellipsis> CQRS </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/saga/ class=md-nav__link> <span class=md-ellipsis> Saga </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/dlq/ class=md-nav__link> <span class=md-ellipsis> Dead Letter Queue </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/topic-replication/ class=md-nav__link> <span class=md-ellipsis> Topic Replication </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/data-pipeline/ class=md-nav__link> <span class=md-ellipsis> Data Intensive App </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/realtime-analytics/ class=md-nav__link> <span class=md-ellipsis> Near real-time analytics </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/api-mgt/ class=md-nav__link> <span class=md-ellipsis> API management </span> </a> </li> <li class=md-nav__item> <a href=../../patterns/cep/ class=md-nav__link> <span class=md-ellipsis> Situational decision </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/domain-driven-design/ class=md-nav__link> <span class=md-ellipsis> Domain-Driven Design </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/data-intensive/ class=md-nav__link> <span class=md-ellipsis> Data Intensive App Development </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/data-lineage/ class=md-nav__link> <span class=md-ellipsis> Data lineage </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Technology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../technology/kafka-overview/ class=md-nav__link> <span class=md-ellipsis> Kafka Overview </span> </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/ class=md-nav__link> <span class=md-ellipsis> Event Streams </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-tech-academy/demo/ class=md-nav__link> <span class=md-ellipsis> Event Streams Demo Script </span> </a> </li> <li class=md-nav__item> <a href=../../technology/faq/ class=md-nav__link> <span class=md-ellipsis> Kafka FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../technology/mq/ class=md-nav__link> <span class=md-ellipsis> MQ in EDA context </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-producers/ class=md-nav__link> <span class=md-ellipsis> Kafka Producers </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-consumers/ class=md-nav__link> <span class=md-ellipsis> Kafka Consumers </span> </a> </li> <li class=md-nav__item> <a href=../../technology/avro-schemas/ class=md-nav__link> <span class=md-ellipsis> Avro Schema </span> </a> </li> <li class=md-nav__item> <a href=../../technology/advanced-kafka/ class=md-nav__link> <span class=md-ellipsis> Advanced Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-streams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-connect/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-maas/security/ class=md-nav__link> <span class=md-ellipsis> Kafka security </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-monitoring/ class=md-nav__link> <span class=md-ellipsis> Kafka Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../technology/kafka-mirrormaker/ class=md-nav__link> <span class=md-ellipsis> Mirror Maker 2 </span> </a> </li> <li class=md-nav__item> <a href=../../technology/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../technology/flink/ class=md-nav__link> <span class=md-ellipsis> Apache Flink </span> </a> </li> <li class=md-nav__item> <a href=../../technology/spring/ class=md-nav__link> <span class=md-ellipsis> Spring cloud </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10 checked> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=true> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gitops/ class=md-nav__link> <span class=md-ellipsis> Event-driven solution GitOps </span> </a> </li> <li class=md-nav__item> <a href=../../technology/event-streams/es-cp4i/ class=md-nav__link> <span class=md-ellipsis> Deploy Event-Streams </span> </a> </li> <li class=md-nav__item> <a href=../connect-s3/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - S3 </span> </a> </li> <li class=md-nav__item> <a href=../connect-cos/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - COS </span> </a> </li> <li class=md-nav__item> <a href=../connect-jdbc/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - jdbc </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kafka Connect - MQ </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kafka Connect - MQ </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#audience class=md-nav__link> <span class=md-ellipsis> Audience </span> </a> </li> <li class=md-nav__item> <a href=#pre-requisites-to-all-labs class=md-nav__link> <span class=md-ellipsis> Pre-requisites to all labs </span> </a> </li> <li class=md-nav__item> <a href=#lab-1-mq-source-to-event-streams-using-the-admin-console class=md-nav__link> <span class=md-ellipsis> Lab 1: MQ source to Event Streams Using the Admin Console </span> </a> <nav class=md-nav aria-label="Lab 1: MQ source to Event Streams Using the Admin Console"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-setup class=md-nav__link> <span class=md-ellipsis> Get setup </span> </a> </li> <li class=md-nav__item> <a href=#deploy-store-simulator class=md-nav__link> <span class=md-ellipsis> Deploy Store simulator </span> </a> </li> <li class=md-nav__item> <a href=#deploy-kafka-connect class=md-nav__link> <span class=md-ellipsis> Deploy Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=#demonstration-scripts class=md-nav__link> <span class=md-ellipsis> Demonstration scripts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-2-mq-source-to-event-streams-using-gitops class=md-nav__link> <span class=md-ellipsis> Lab 2: MQ source to Event Streams using GitOps </span> </a> </li> <li class=md-nav__item> <a href=#lab-3-mq-sink-from-kafka class=md-nav__link> <span class=md-ellipsis> Lab 3: MQ Sink from Kafka </span> </a> <nav class=md-nav aria-label="Lab 3: MQ Sink from Kafka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-mq-channel class=md-nav__link> <span class=md-ellipsis> Setup MQ Channel </span> </a> </li> <li class=md-nav__item> <a href=#setup-kafka-connect-cluster class=md-nav__link> <span class=md-ellipsis> Setup Kafka Connect Cluster </span> </a> </li> <li class=md-nav__item> <a href=#add-the-mq-sink-connector class=md-nav__link> <span class=md-ellipsis> Add the mq-sink connector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mq-sink-connector-on-virtual-or-baremetal-server-mq-and-event-streams-on-ibm-cloud class=md-nav__link> <span class=md-ellipsis> MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud </span> </a> <nav class=md-nav aria-label="MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> <span class=md-ellipsis> Pre-requisites </span> </a> </li> <li class=md-nav__item> <a href=#create-local-ibm-mq-instance class=md-nav__link> <span class=md-ellipsis> Create Local IBM MQ Instance </span> </a> </li> <li class=md-nav__item> <a href=#create-mq-kafka-connector-sink class=md-nav__link> <span class=md-ellipsis> Create MQ Kafka Connector Sink </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-4-mq-connector-with-kafka-confluent class=md-nav__link> <span class=md-ellipsis> Lab 4: MQ Connector with Kafka Confluent </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../connect-rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Kafka Connect - Rabbitmq </span> </a> </li> <li class=md-nav__item> <a href=../kafka-streams/ class=md-nav__link> <span class=md-ellipsis> Kafka Streams labs </span> </a> </li> <li class=md-nav__item> <a href=../db2-debezium/ class=md-nav__link> <span class=md-ellipsis> DB2 - CDC Debezium - Outbox </span> </a> </li> <li class=md-nav__item> <a href=../kafka-mm2/ class=md-nav__link> <span class=md-ellipsis> Mirror maker 2 labs </span> </a> </li> <li class=md-nav__item> <a href=../schema-registry-on-cloud/ class=md-nav__link> <span class=md-ellipsis> Schema registry ES on Cloud </span> </a> </li> <li class=md-nav__item> <a href=../schema-registry-on-ocp/ class=md-nav__link> <span class=md-ellipsis> Schema registry </span> </a> </li> <li class=md-nav__item> <a href=../monitoring-on-cloud/ class=md-nav__link> <span class=md-ellipsis> Monitoring ES on Cloud </span> </a> </li> <li class=md-nav__item> <a href=../monitoring-on-ocp/ class=md-nav__link> <span class=md-ellipsis> Monitoring ES </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Scenarios </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Scenarios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/refarch-kc/ class=md-nav__link> <span class=md-ellipsis> Reefer Shipment Solution </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/vaccine-solution-main/ class=md-nav__link> <span class=md-ellipsis> Vaccine at Scale </span> </a> </li> <li class=md-nav__item> <a href=https://ibm-cloud-architecture.github.io/eda-rt-inventory-gitops class=md-nav__link> <span class=md-ellipsis> Near real-time Inventory </span> </a> </li> <li class=md-nav__item> <a href=../../scenarios/saga-orchestration/ class=md-nav__link> <span class=md-ellipsis> SAGA with MQ Orchestration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../additional-reading/ class=md-nav__link> <span class=md-ellipsis> Additional reading </span> </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> <span class=md-ellipsis> Contribute to this Site </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#audience class=md-nav__link> <span class=md-ellipsis> Audience </span> </a> </li> <li class=md-nav__item> <a href=#pre-requisites-to-all-labs class=md-nav__link> <span class=md-ellipsis> Pre-requisites to all labs </span> </a> </li> <li class=md-nav__item> <a href=#lab-1-mq-source-to-event-streams-using-the-admin-console class=md-nav__link> <span class=md-ellipsis> Lab 1: MQ source to Event Streams Using the Admin Console </span> </a> <nav class=md-nav aria-label="Lab 1: MQ source to Event Streams Using the Admin Console"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-setup class=md-nav__link> <span class=md-ellipsis> Get setup </span> </a> </li> <li class=md-nav__item> <a href=#deploy-store-simulator class=md-nav__link> <span class=md-ellipsis> Deploy Store simulator </span> </a> </li> <li class=md-nav__item> <a href=#deploy-kafka-connect class=md-nav__link> <span class=md-ellipsis> Deploy Kafka Connect </span> </a> </li> <li class=md-nav__item> <a href=#demonstration-scripts class=md-nav__link> <span class=md-ellipsis> Demonstration scripts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-2-mq-source-to-event-streams-using-gitops class=md-nav__link> <span class=md-ellipsis> Lab 2: MQ source to Event Streams using GitOps </span> </a> </li> <li class=md-nav__item> <a href=#lab-3-mq-sink-from-kafka class=md-nav__link> <span class=md-ellipsis> Lab 3: MQ Sink from Kafka </span> </a> <nav class=md-nav aria-label="Lab 3: MQ Sink from Kafka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-mq-channel class=md-nav__link> <span class=md-ellipsis> Setup MQ Channel </span> </a> </li> <li class=md-nav__item> <a href=#setup-kafka-connect-cluster class=md-nav__link> <span class=md-ellipsis> Setup Kafka Connect Cluster </span> </a> </li> <li class=md-nav__item> <a href=#add-the-mq-sink-connector class=md-nav__link> <span class=md-ellipsis> Add the mq-sink connector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mq-sink-connector-on-virtual-or-baremetal-server-mq-and-event-streams-on-ibm-cloud class=md-nav__link> <span class=md-ellipsis> MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud </span> </a> <nav class=md-nav aria-label="MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> <span class=md-ellipsis> Pre-requisites </span> </a> </li> <li class=md-nav__item> <a href=#create-local-ibm-mq-instance class=md-nav__link> <span class=md-ellipsis> Create Local IBM MQ Instance </span> </a> </li> <li class=md-nav__item> <a href=#create-mq-kafka-connector-sink class=md-nav__link> <span class=md-ellipsis> Create MQ Kafka Connector Sink </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lab-4-mq-connector-with-kafka-confluent class=md-nav__link> <span class=md-ellipsis> Lab 4: MQ Connector with Kafka Confluent </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Kafka Connect - MQ</h1> <p>This extended scenario supports different labs going from simple to more complex and addresses how to integrate IBM MQ with Event Streams Kafka as part of Cloud Pak for Integration using Kafka Connect with IBM MQ Kafka Connectors. </p> <p>To run the same Lab with Kafka Confluent see the <a href=https://github.com/ibm-cloud-architecture/eda-lab-mq-to-kafka>ibm-cloud-architecture/eda-lab-mq-to-kafka readme file.</a></p> <p><anchorlinks> <anchorlink>Pre-requisites to all labs</anchorlink> <anchorlink>Lab 1: MQ source to Event Streams Using the Admin Console</anchorlink> <anchorlink>Lab 2: MQ source to Event Streams using GitOps</anchorlink> <anchorlink>Lab 3: MQ Sink from Kafka</anchorlink> <anchorlink>Lab 4: MQ Connector with Kafka Confluent</anchorlink> </anchorlinks></p> <h2 id=audience>Audience<a class=headerlink href=#audience title="Permanent link">&para;</a></h2> <p>We assume readers have good knowledge of OpenShift to login, to naivgate into the Administrator console and use OC and GIT CLIs.</p> <h2 id=pre-requisites-to-all-labs>Pre-requisites to all labs<a class=headerlink href=#pre-requisites-to-all-labs title="Permanent link">&para;</a></h2> <ul> <li>Access to an OpenShift Cluster and Console</li> <li>Login to the OpenShift Console and get the <code>access token</code> to use <code>oc login</code>.</li> <li>Access to <a href=https://git-scm.com/ >git cli</a> from your workstation</li> <li>Clone Lab repository</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ibm-cloud-architecture/eda-lab-mq-to-kafka.git
</code></pre></div> <h2 id=lab-1-mq-source-to-event-streams-using-the-admin-console>Lab 1: MQ source to Event Streams Using the Admin Console<a class=headerlink href=#lab-1-mq-source-to-event-streams-using-the-admin-console title="Permanent link">&para;</a></h2> <p>In this lab we assume Cloud Pak for Integration is deployed with Event Streams cluster created and at least one MQ Broker created. If not see <a href=/technology/event-streams/es-cp4i#install-event-streams-using-openshift-console>this note to install Event Streams operator and defining one Kafka cluster</a> using the OpenShift Console and <a href=/technology/mq/#installation-with-cloud-pak-for-integration>this note to install one MQ Operator and one MQ Broker</a>. </p> <p>The following figure illustrates what we will deploy:</p> <p><img alt src=images/mq-kafka-lab1.png></p> <ul> <li>The Sell Store simulator is a separate application available in <a href=https://github.com/ibm-cloud-architecture/refarch-eda-store-simulator>the refarch-eda-store-simulator public github</a> and the docker image is accessible from the <a href=https://quay.io/repository/ibmcase/eda-store-simulator>quay.io registry</a>.</li> <li>The Event Streams cluster is named <code>dev</code></li> </ul> <h3 id=get-setup>Get setup<a class=headerlink href=#get-setup title="Permanent link">&para;</a></h3> <ul> <li>Get Cloud Pak for Integration <code>admin</code> user password</li> </ul> <p><div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>oc<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>platform-auth-idp-credentials<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.data.admin_password}&#39;</span><span class=w> </span>-n<span class=w> </span>ibm-common-services<span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</code></pre></div> * Access to the Event Streams console</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>oc<span class=w> </span>get<span class=w> </span>routes
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=c1># </span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>oc<span class=w> </span>get<span class=w> </span>route<span class=w> </span>dev-ibm-es-ui<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.host}&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</code></pre></div> <p>Use this URL to access to the Event Stream console:</p> <p><img alt src=images/es-console.png></p> <ul> <li>Using the Topic menu, create the <code>items</code> topic with 1 partition, use default retention time, and 3 replicas</li> <li>Get <a href=/technology/event-streams/es-cp4i#get-kafka-bootstrap-url>Internal Kafka bootstrap URL</a></li> </ul> <p><img alt src=images/internal-url.png></p> <p>and generate TLS credentials with the name <code>tls-mq-user</code> with the <code>Produce messages, consume messages and create topics and schemas</code> permissions, </p> <p><img alt src=images/tls-mq-user.png></p> <p>on <code>items</code> topic:</p> <p><img alt src=images/items-topic.png></p> <p>All consumer groups, as we may reuse this user for consumers.</p> <p>You can download the certificates, but in fact it is not necessary as we will use the created secrets to configure MQ Kafka connector.</p> <ul> <li>Get MQ Console route from the namespace where MQ brokers run</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>oc<span class=w> </span>get<span class=w> </span>routes<span class=w> </span>-n<span class=w> </span>cp4i<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>mq-web
</code></pre></div> <ul> <li>Access to MQ Broker Console &gt; Manage to see the Broker configured </li> </ul> <p><img alt src=images/mq-manage.png></p> <ul> <li>Add the local <code>items</code> queue </li> </ul> <p><img alt src=images/create-queue.png></p> <p><img alt src=images/create-queue-2.png></p> <ul> <li>Verify MQ App channels defined</li> </ul> <p><img alt src=images/mq-app-channel.png></p> <ul> <li>Create an OpenShift project named: <code>mq-es-demo</code> with the command: <code>oc new-project mq-es-demo</code></li> <li>Clone the git <code>ibm-cloud-architecture/eda-lab-mq-to-kafka</code> repository:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ibm-cloud-architecture/eda-lab-mq-to-kafka
</code></pre></div> <ul> <li>Update the configMap named <code>store-simulator-cm</code> in folder <code>kustomize/apps/store-simulator/overlays</code> for the store simulator: <code>Workloads &gt; ConfigMaps &gt; Create</code> and use the parameters from MQ_HOST and MQ_CHANNEL.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=w> </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w> </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w> </span><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>   </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">store-simulator-cm</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w> </span><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>   </span><span class=nt>APP_VERSION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0.0.6</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>   </span><span class=nt>APP_TARGET_MESSAGING</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IBMMQ</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>   </span><span class=nt>MQ_HOST</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">store-mq-ibm-mq.cp4i.svc</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>   </span><span class=nt>MQ_PORT</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1414&quot;</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>   </span><span class=nt>MQ_QMGR</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">QM1</span><span class=w> </span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>   </span><span class=nt>MQ_QUEUE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">items</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>   </span><span class=nt>MQ_CHANNEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DEV.APP.SVRCONN</span>
</code></pre></div> <h3 id=deploy-store-simulator>Deploy Store simulator<a class=headerlink href=#deploy-store-simulator title="Permanent link">&para;</a></h3> <ul> <li>Deploy to the OpenShift project</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>oc<span class=w> </span>project<span class=w> </span>mq-es-demo
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>oc<span class=w> </span>apply<span class=w> </span>-k<span class=w>  </span>kustomize/apps/store-simulator/overlays
</code></pre></div> <ul> <li>Access to the application web interface:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=w> </span>oc<span class=w> </span>get<span class=w> </span>route<span class=w> </span>store-simulator<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.host}&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
</code></pre></div> <p><img src=./images/ alt></p> <h3 id=deploy-kafka-connect>Deploy Kafka Connect<a class=headerlink href=#deploy-kafka-connect title="Permanent link">&para;</a></h3> <p>The Event Streams MQ Source connector <a href=https://ibm.github.io/event-streams/connecting/mq/source/ >product documentation</a> describes what need to be done in details. Basically we have to do two things:</p> <ul> <li>Build the connector image with the needed jars for all the connectos we want to use. For example we need jar files for the MQ connector and jars for the MQ client api.</li> <li>Start a specific connector with the parameters to connect to the external system and to kafka.</li> </ul> <p>To make the MQ source connector immediatly useable for the demonstration, we have build a connector image at <code>quay.io/ibmcase/demomqconnect</code> and the kafkaconnect.yaml is in <a href=https://raw.githubusercontent.com/ibm-cloud-architecture/store-mq-gitops/main/environments/smq-dev/apps/services/kafkaconnect/kafka-connect.yaml>this file</a>.</p> <p>To deploy the kafka connect framework do:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>oc<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/ibm-cloud-architecture/eda-lab-mq-to-kafka/main/kustomize/environment/kconnect/es-mq/kafka-connect.yaml
</code></pre></div> <p>Then start the MQ source connector:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>oc<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>https://raw.githubusercontent.com/ibm-cloud-architecture/eda-lab-mq-to-kafka/main/kustomize/environment/kconnect/es-mq/mq-src-connector.yaml
</code></pre></div> <h3 id=demonstration-scripts>Demonstration scripts<a class=headerlink href=#demonstration-scripts title="Permanent link">&para;</a></h3> <ol> <li>The solution has multiple stores as presented in the <code>stores</code> menu. </li> </ol> <p><img alt src=images/stores-view.png></p> <ol> <li>In the <code>simulator</code> menu, select the IBMMQ backend, and send some messages randomly using the left button after selecting the number of messages to send or run the predefined scenario with the right button:</li> </ol> <p><img alt src=images/demo-scenarios.png></p> <ol> <li>In MQ Broker Console go to the <code>items</code> queue to see the messages generated from the simulator</li> </ol> <p><img alt src=images/mq-msgs.png></p> <ol> <li>In Event Streams console goes to the <code>items</code> topic to see the same messages produced by the Kafka MQ Source connector.</li> </ol> <h2 id=lab-2-mq-source-to-event-streams-using-gitops>Lab 2: MQ source to Event Streams using GitOps<a class=headerlink href=#lab-2-mq-source-to-event-streams-using-gitops title="Permanent link">&para;</a></h2> <p>This labs uses GitOps approach with OpenShift GitOps product (ArgoCD) to deploy IBM Event Streams, MQ, the Store Simulator app, and Kafka Connect in the minimum of work. It can be used on a OpenShift Cluster witout any previously deployed Cloud Pak for Integration opersators. Basically as a SRE you will jumpstart the GitOps operator and then starts ArgoCD.</p> <ul> <li>Clone the <code>store-mq-gitops</code> repo</li> </ul> <p><div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ibm-cloud-architecture/store-mq-gitops
</code></pre></div> * Follow the instructions from the repository main Readme file.</p> <h2 id=lab-3-mq-sink-from-kafka>Lab 3: MQ Sink from Kafka<a class=headerlink href=#lab-3-mq-sink-from-kafka title="Permanent link">&para;</a></h2> <p>A may be less used Kafka connector will be to use the MQ Sink connector to get data from Kafka to MQ. This lab addresses such integration. The target deployment looks like in the following diagram:</p> <p><img alt=1 src=images/all-ocp.png></p> <p>Kafka is runnning in its own namespace, and we are using Event Streams from Cloud Pack for Integration.</p> <h3 id=setup-mq-channel>Setup MQ Channel<a class=headerlink href=#setup-mq-channel title="Permanent link">&para;</a></h3> <p>Open a shell on the remote container or use the user interface to define the communication channel to use for the Kafka Connection.</p> <ul> <li>Using CLI: Change the name of the Q manager to reflect what you defined in MQ configuration.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>runmqsc<span class=w> </span>EDAQMGR1
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1># Define a app channel using server connection</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>DEFINE<span class=w> </span>CHANNEL<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>CHLTYPE<span class=o>(</span>SVRCONN<span class=o>)</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># Set the channel authentication rules to accept connections requiring userid and password</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>BLOCKUSER<span class=o>)</span><span class=w> </span>USERLIST<span class=o>(</span><span class=s1>&#39;nobody&#39;</span><span class=o>)</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>ADDRESSMAP<span class=o>)</span><span class=w> </span>ADDRESS<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>USERSRC<span class=o>(</span>NOACCESS<span class=o>)</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>ADDRESSMAP<span class=o>)</span><span class=w> </span>ADDRESS<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>USERSRC<span class=o>(</span>CHANNEL<span class=o>)</span><span class=w> </span>CHCKCLNT<span class=o>(</span>REQUIRED<span class=o>)</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=c1># Set identity of the client connections</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>ALTER<span class=w> </span>AUTHINFO<span class=o>(</span>SYSTEM.DEFAULT.AUTHINFO.IDPWOS<span class=o>)</span><span class=w> </span>AUTHTYPE<span class=o>(</span>IDPWOS<span class=o>)</span><span class=w> </span>ADOPTCTX<span class=o>(</span>YES<span class=o>)</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>REFRESH<span class=w> </span>SECURITY<span class=w> </span>TYPE<span class=o>(</span>CONNAUTH<span class=o>)</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=c1># Define inventory queue</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>DEFINE<span class=w> </span>QLOCAL<span class=o>(</span>INVENTORY<span class=o>)</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=c1># Authorize the IBM MQ user ID to connect to and inquire the queue manager</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>SET<span class=w> </span>AUTHREC<span class=w> </span>OBJTYPE<span class=o>(</span>QMGR<span class=o>)</span><span class=w> </span>PRINCIPAL<span class=o>(</span><span class=s1>&#39;admin&#39;</span><span class=o>)</span><span class=w> </span>AUTHADD<span class=o>(</span>CONNECT,INQ<span class=o>)</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=c1># Authorize the IBM MQ user ID to use the queue:</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>SET<span class=w> </span>AUTHREC<span class=w> </span>PROFILE<span class=o>(</span>INVENTORY<span class=o>)</span><span class=w> </span>OBJTYPE<span class=o>(</span>QUEUE<span class=o>)</span><span class=w> </span>PRINCIPAL<span class=o>(</span><span class=s1>&#39;admin&#39;</span><span class=o>)</span><span class=w> </span>AUTHADD<span class=o>(</span>ALLMQI<span class=o>)</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=c1># done</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>END
</code></pre></div> <ul> <li>As an alternate you can use the MQ administration console.</li> </ul> <p>TBD</p> <h3 id=setup-kafka-connect-cluster>Setup Kafka Connect Cluster<a class=headerlink href=#setup-kafka-connect-cluster title="Permanent link">&para;</a></h3> <p>Connectors can be added to a Kafka Connect environment using OpenShift CLI commands and the source to image customer resource. We will use the Strimzi operator console to setup kafka connect environment. </p> <p>Once you downloaded the zip file, which is a yaml manifest, define the configuration for a KafkaConnectS2I instance. The major configuration settings are the server certificate settings and the authentication using Mutual TLS authentication, something like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>  </span><span class=nt>bootstrapServers</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sandbox-rp-kafka-bootstrap.eventstreams.svc:9093</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=nt>trustedCertificates</span><span class=p>:</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sandbox-rp-cluster-ca-cert</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>      </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ca.crt</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=nt>authentication</span><span class=p>:</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tls</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>    </span><span class=nt>certificate</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user.crt</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user.key</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sandbox-rp-tls-cred</span>
</code></pre></div> <p>If you change the name of the connect cluster in the metadata, modify also the name: <code>spec.template.pod.metadata.annotations. productChargedContainers</code> accordingly.</p> <p>The secrets used above, need to be accessible from the project where the connector is deployed. The simple way to do so is to copy the source certificates from the Event streams project to your current project with the commands like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>oc<span class=w> </span>get<span class=w> </span>secret<span class=w>  </span>sandbox-rp-cluster-ca-cert<span class=w>  </span>-n<span class=w> </span>eventstreams<span class=w> </span>--export<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span><span class=p>|</span><span class=w> </span>oc<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>oc<span class=w> </span>get<span class=w> </span>secret<span class=w>  </span>sandbox-rp-tls-cred<span class=w>  </span>-n<span class=w> </span>eventstreams<span class=w> </span>--export<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span><span class=p>|</span><span class=w> </span>oc<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-
</code></pre></div> <p>If you do not have a TLS client certificate from a TLS user, use <a href=../../overview/pre-requisites#getting-tls-authentication-from-event-streams-on-openshift>this note</a> to create one.</p> <ul> <li>Deploy the connector cluster</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>oc<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>kafka-connect-s2i.yaml<span class=w> </span>
</code></pre></div> <p>An instance of this custom resource represents a Kafka Connect distributed worker cluster. In this mode, workload balancing is automatic, scaling is dynamic, and tasks and data are fault-tolerant. Each connector is represented by another custom resource called KafkaConnector.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>oc<span class=w> </span>describe<span class=w> </span>kafkaconnects2i<span class=w> </span>eda-connect-cluster
</code></pre></div> <h3 id=add-the-mq-sink-connector>Add the mq-sink connector<a class=headerlink href=#add-the-mq-sink-connector title="Permanent link">&para;</a></h3> <p>The <a href=https://ibm.github.io/event-streams/connecting/mq/ >product documentation</a> details the available MQ connectors and the configuration process. Using the event streams console, the process is quite simple to get a connector configuration as json file. Here is an example of the final form to generate the json file:</p> <p><img alt=6 src=images/es-mq-sink.png></p> <ul> <li>Once the json is downloaded, complete the settings</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=p>{</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>  </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;mq-sink&quot;</span><span class=p>,</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>  </span><span class=nt>&quot;config&quot;</span><span class=p>:</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>      </span><span class=nt>&quot;connector.class&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.MQSinkConnector&quot;</span><span class=p>,</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>      </span><span class=nt>&quot;tasks.max&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=p>,</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>      </span><span class=nt>&quot;topics&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;inventory&quot;</span><span class=p>,</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>      </span><span class=nt>&quot;key.converter&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span class=p>,</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>      </span><span class=nt>&quot;value.converter&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span class=p>,</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>      </span><span class=nt>&quot;mq.queue.manager&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;EDAQMGR1&quot;</span><span class=p>,</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>      </span><span class=nt>&quot;mq.connection.name.list&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;eda-mq-lab-ibm-mq(1414)&quot;</span><span class=p>,</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>      </span><span class=nt>&quot;mq.user.name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;admin&quot;</span><span class=p>,</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>      </span><span class=nt>&quot;mq.password&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;passw0rd&quot;</span><span class=p>,</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>      </span><span class=nt>&quot;mq.user.authentication.mqcsp&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>      </span><span class=nt>&quot;mq.channel.name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;KAFKA.CHANNEL&quot;</span><span class=p>,</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>      </span><span class=nt>&quot;mq.queue&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;INVENTORY&quot;</span><span class=p>,</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=w>      </span><span class=nt>&quot;mq.message.builder&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder&quot;</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=p>}</span>
</code></pre></div> <ul> <li>To run the connector within the cluster, we need to connector jar. You can download this jar file from the Event Stream adming console <code>&gt; Toolkit &gt; Add connector to your Kafka Connect environment &gt; Add Connector &gt; IBM MQ Connectors</code>,</li> </ul> <p><img alt src=images/es-mq-sink-1.png></p> <p>or as an alternate, we <a href=https://github.com/ibm-messaging/kafka-connect-mq-sink.git>cloned the mq-sink code</a>, so a <code>mvn package</code> command under <code>kafka-connect-mq-sink</code> folder will build the jar. Copy this jar under <code>cp4i/my-plugins</code> folder. * Build the connector with source to image component.</p> <p>With the correct credentials for IBM EventStreams and IBM MQ, Kafka Connect should connect to both services and pull data from the EventStreams topic configured to the MQ Queue configured. You will see signs of success in the container output (via oc logs, or in the UI):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>+<span class=w> </span>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>-H<span class=w> </span>Content-Type:<span class=w> </span>application/json<span class=w> </span>http://localhost:8083/connectors<span class=w> </span>--data<span class=w> </span>@/opt/kafka-connect-mq-sink/config/mq-sink.json
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>...
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=o>{</span><span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;mq-sink-connector&quot;</span>,<span class=s2>&quot;config&quot;</span>:<span class=o>{</span><span class=s2>&quot;connector.class&quot;</span>:<span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.MQSinkConnector&quot;</span>,<span class=s2>&quot;tasks.max&quot;</span>:<span class=s2>&quot;1&quot;</span>,<span class=s2>&quot;topics&quot;</span>:<span class=s2>&quot;inventory&quot;</span>,<span class=s2>&quot;key.converter&quot;</span>:<span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span>,<span class=s2>&quot;value.converter&quot;</span>:<span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span>,<span class=s2>&quot;mq.queue.manager&quot;</span>:<span class=s2>&quot;QM1&quot;</span>,<span class=s2>&quot;mq.connection.name.list&quot;</span>:<span class=s2>&quot;mq-service(1414)&quot;</span>,<span class=s2>&quot;mq.user.name&quot;</span>:<span class=s2>&quot;admin&quot;</span>,<span class=s2>&quot;mq.password&quot;</span>:<span class=s2>&quot;passw0rd&quot;</span>,<span class=s2>&quot;mq.user.authentication.mqcsp&quot;</span>:<span class=s2>&quot;true&quot;</span>,<span class=s2>&quot;mq.channel.name&quot;</span>:<span class=s2>&quot;KAFKA.CHANNEL&quot;</span>,<span class=s2>&quot;mq.queue&quot;</span>:<span class=s2>&quot;INVENTORY&quot;</span>,<span class=s2>&quot;mq.message.builder&quot;</span>:<span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder&quot;</span>,<span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;mq-sink-connector&quot;</span><span class=o>}</span>,<span class=s2>&quot;tasks&quot;</span>:<span class=o>[{</span><span class=s2>&quot;connector&quot;</span>:<span class=s2>&quot;mq-sink-connector&quot;</span>,<span class=s2>&quot;task&quot;</span>:0<span class=o>}]</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;sink&quot;</span><span class=o>}</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>...
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=o>[</span><span class=m>2020</span>-06-23<span class=w> </span><span class=m>04</span>:26:26,054<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>Creating<span class=w> </span>task<span class=w> </span>mq-sink-connector-0<span class=w> </span><span class=o>(</span>org.apache.kafka.connect.runtime.Worker:419<span class=o>)</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>...<span class=o>[</span><span class=m>2020</span>-06-23<span class=w> </span><span class=m>04</span>:26:26,449<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>Connection<span class=w> </span>to<span class=w> </span>MQ<span class=w> </span>established<span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.JMSWriter:229<span class=o>)</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=o>[</span><span class=m>2020</span>-06-23<span class=w> </span><span class=m>04</span>:26:26,449<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>WorkerSinkTask<span class=o>{</span><span class=nv>id</span><span class=o>=</span>mq-sink-connector-0<span class=o>}</span><span class=w> </span>Sink<span class=w> </span>task<span class=w> </span>finished<span class=w> </span>initialization<span class=w> </span>and<span class=w> </span>start<span class=w> </span><span class=o>(</span>org.apache.kafka.connect.runtime.WorkerSinkTask:306<span class=o>)</span>
</code></pre></div> <p>You should now have the Kafka Connector MQ Sink running on OpenShift.</p> <h2 id=mq-sink-connector-on-virtual-or-baremetal-server-mq-and-event-streams-on-ibm-cloud>MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud<a class=headerlink href=#mq-sink-connector-on-virtual-or-baremetal-server-mq-and-event-streams-on-ibm-cloud title="Permanent link">&para;</a></h2> <p>In this second option, we are using our own laptop for the baremetal dedployment, but the current solution will work the same on virtual server.</p> <p><img alt=2 src=images/hybrid.png></p> <h3 id=pre-requisites>Pre-requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h3> <p>We assume that you have an instance of IBM Event Streams already running on IBM Cloud or on OpenShift with at least administrator credentials created. The credentials will be needed later on for configuring the Kafka Connect framework to be able to connect and work with your IBM Event Streams instance. Also, this scenario requires a topic called <code>inventory</code> in your IBM Event Streams instance. For gathering the credentials and creating the topic required for this scenario, please review the <a href=/use-cases/overview/pre-requisites/ >Common pre-requisites</a>. <strong>IMPORTANT:</strong> if you are sharing your IBM Event Streams instance, append some unique identifier to the topic you create in IBM Event Streams.</p> <h3 id=create-local-ibm-mq-instance>Create Local IBM MQ Instance<a class=headerlink href=#create-local-ibm-mq-instance title="Permanent link">&para;</a></h3> <p>In this section we are going to use Docker to create a local IBM MQ instance to simulate an IBM MQ instance somewhere in our datacenter.</p> <ol> <li>Create a data directory to mount onto the container.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>mkdir<span class=w> </span>qm1data
</code></pre></div> <ol> <li>Run the IBM MQ official Docker image by execting the following command.</li> </ol> <p><div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>docker<span class=w> </span>run<span class=w>                     </span><span class=se>\</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>  </span>--name<span class=w> </span>mq<span class=w>                    </span><span class=se>\</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>  </span>--detach<span class=w>                     </span><span class=se>\</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>  </span>--publish<span class=w> </span><span class=m>1414</span>:1414<span class=w>          </span><span class=se>\</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>  </span>--publish<span class=w> </span><span class=m>9443</span>:9443<span class=w>          </span><span class=se>\</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>  </span>--publish<span class=w> </span><span class=m>9157</span>:9157<span class=w>          </span><span class=se>\</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>  </span>--volume<span class=w> </span>qm1data:/mnt/mqm<span class=w>    </span><span class=se>\</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span>--env<span class=w> </span><span class=nv>LICENSE</span><span class=o>=</span>accept<span class=w>         </span><span class=se>\</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>  </span>--env<span class=w> </span><span class=nv>MQ_QMGR_NAME</span><span class=o>=</span>QM1<span class=w>       </span><span class=se>\</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>  </span>--env<span class=w> </span><span class=nv>MQ_APP_PASSWORD</span><span class=o>=</span>admin<span class=w>  </span><span class=se>\</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>  </span>--env<span class=w> </span><span class=nv>MQ_ENABLE_METRICS</span><span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>  </span>ibmcom/mq
</code></pre></div> where we can see that out container will be called <code>mq</code>, it will run in <code>detached</code> mode (i.e. in the background), it will expose the ports IBM MQ uses for communication and the image we are actually running <code>ibmcom/mq</code>.</p> <ol> <li>You could make sure your IBM MQ Docker image is running by listing the Docker containers in your workstation.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>$<span class=w> </span>docker<span class=w> </span>ps
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>CONTAINER<span class=w> </span>ID<span class=w>   </span>IMAGE<span class=w>       </span>COMMAND<span class=w>            </span>CREATED<span class=w>         </span>STATUS<span class=w>         </span>PORTS<span class=w>                                                                    </span>NAMES
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>a7b2a115a3c6<span class=w>   </span>ibmcom/mq<span class=w>   </span><span class=s2>&quot;runmqdevserver&quot;</span><span class=w>   </span><span class=m>6</span><span class=w> </span>minutes<span class=w> </span>ago<span class=w>   </span>Up<span class=w> </span><span class=m>6</span><span class=w> </span>minutes<span class=w>   </span><span class=m>0</span>.0.0.0:1414-&gt;1414/tcp,<span class=w> </span><span class=m>0</span>.0.0.0:9157-&gt;9157/tcp,<span class=w> </span><span class=m>0</span>.0.0.0:9443-&gt;9443/tcp<span class=w>   </span>mq
</code></pre></div> <ol> <li>You should also be able to log into the MQ server on port 9443 (<a href=https://localhost:9443>https://localhost:9443</a>) with default user <code>admin</code> and password <code>passw0rd</code>.</li> </ol> <p><img alt=login src=images/login.png></p> <p>Now, we need to configure our local IBM MQ instance Queue Manager in order to define a server connection (<code>KAFKA.CHANNEL</code>) with authentication (user <code>admin</code>, password <code>admin</code>) and the queue (<code>INVENTORY</code>) where our messages from Kafka will be sinked to. And we are going to so it using the IBM MQ CLI.</p> <ol> <li>Get into the IBM MQ Docker container we have started above by executing the following command that will give us a <code>bash</code> interactive terminal:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-ti<span class=w> </span>mq<span class=w> </span>bash
</code></pre></div> <ol> <li>Now that we are in the container, start the queue manager <code>QM1</code> by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>strmqm<span class=w> </span>QM1
</code></pre></div> <ol> <li>Start the <code>runmqsc</code> tool to configure the queue manager by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>runmqsc<span class=w> </span>QM1
</code></pre></div> <ol> <li>Create a server-connection channel called <code>KAFKA.CHANNEL</code> by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>DEFINE<span class=w> </span>CHANNEL<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>CHLTYPE<span class=o>(</span>SVRCONN<span class=o>)</span>
</code></pre></div> <ol> <li>Set the channel authentication rules to accept connections requiring userid and password by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>BLOCKUSER<span class=o>)</span><span class=w> </span>USERLIST<span class=o>(</span><span class=s1>&#39;nobody&#39;</span><span class=o>)</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>ADDRESSMAP<span class=o>)</span><span class=w> </span>ADDRESS<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>USERSRC<span class=o>(</span>NOACCESS<span class=o>)</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>SET<span class=w> </span>CHLAUTH<span class=o>(</span>KAFKA.CHANNEL<span class=o>)</span><span class=w> </span>TYPE<span class=o>(</span>ADDRESSMAP<span class=o>)</span><span class=w> </span>ADDRESS<span class=o>(</span><span class=s1>&#39;*&#39;</span><span class=o>)</span><span class=w> </span>USERSRC<span class=o>(</span>CHANNEL<span class=o>)</span><span class=w> </span>CHCKCLNT<span class=o>(</span>REQUIRED<span class=o>)</span>
</code></pre></div> <ol> <li>Set the identity of the client connections based on the supplied context, the user ID by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>ALTER<span class=w> </span>AUTHINFO<span class=o>(</span>SYSTEM.DEFAULT.AUTHINFO.IDPWOS<span class=o>)</span><span class=w> </span>AUTHTYPE<span class=o>(</span>IDPWOS<span class=o>)</span><span class=w> </span>ADOPTCTX<span class=o>(</span>YES<span class=o>)</span>
</code></pre></div> <ol> <li>Refresh the connection authentication information by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>REFRESH<span class=w> </span>SECURITY<span class=w> </span>TYPE<span class=o>(</span>CONNAUTH<span class=o>)</span>
</code></pre></div> <ol> <li>Create the <code>INVENTORY</code> queue for the connector to use by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>DEFINE<span class=w> </span>QLOCAL<span class=o>(</span>INVENTORY<span class=o>)</span>
</code></pre></div> <ol> <li>Authorize <code>admin</code> to connect to and inquire the queue manager by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>SET<span class=w> </span>AUTHREC<span class=w> </span>OBJTYPE<span class=o>(</span>QMGR<span class=o>)</span><span class=w> </span>PRINCIPAL<span class=o>(</span><span class=s1>&#39;admin&#39;</span><span class=o>)</span><span class=w> </span>AUTHADD<span class=o>(</span>CONNECT,INQ<span class=o>)</span>
</code></pre></div> <ol> <li>Finally authorize <code>admin</code> to use the queue by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>SET<span class=w> </span>AUTHREC<span class=w> </span>PROFILE<span class=o>(</span>INVENTORY<span class=o>)</span><span class=w> </span>OBJTYPE<span class=o>(</span>QUEUE<span class=o>)</span><span class=w> </span>PRINCIPAL<span class=o>(</span><span class=s1>&#39;admin&#39;</span><span class=o>)</span><span class=w> </span>AUTHADD<span class=o>(</span>ALLMQI<span class=o>)</span>
</code></pre></div> <ol> <li>End <code>runmqsc</code> by executing:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>END
</code></pre></div> <p>You should see the following output:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=m>9</span><span class=w> </span>MQSC<span class=w> </span>commands<span class=w> </span>read.
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>No<span class=w> </span>commands<span class=w> </span>have<span class=w> </span>a<span class=w> </span>syntax<span class=w> </span>error.
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>One<span class=w> </span>valid<span class=w> </span>MQSC<span class=w> </span><span class=nb>command</span><span class=w> </span>could<span class=w> </span>not<span class=w> </span>be<span class=w> </span>processed.
</code></pre></div> <p>Exit the container by executing:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=nb>exit</span>
</code></pre></div> <p>If you check your IBM MQ dashboard you should see your newly created <code>INVENTORY</code> queue:</p> <p><img alt=inventory src=images/inventory_queue.png></p> <h3 id=create-mq-kafka-connector-sink>Create MQ Kafka Connector Sink<a class=headerlink href=#create-mq-kafka-connector-sink title="Permanent link">&para;</a></h3> <p>The MQ Connector Sink can be downloaded from this <a href=https://github.com/ibm-messaging/kafka-connect-mq-sink>Github</a>. The Github site includes exhaustive instructions for further detail on this connector and its usage.</p> <ol> <li>Clone the repository with the following command:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ibm-messaging/kafka-connect-mq-sink.git
</code></pre></div> <ol> <li>Change directory into the <code>kafka-connect-mq-sink</code> directory:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nb>cd</span><span class=w> </span>kafka-connect-mq-sink
</code></pre></div> <ol> <li>Build the connector using Maven:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>mvn<span class=w> </span>clean<span class=w> </span>package
</code></pre></div> <ol> <li>Create a directory (if it does not exist yet) to contain the Kafka Connect framework configuration and cd into it.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>mkdir<span class=w> </span>config
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=nb>cd</span><span class=w> </span>config
</code></pre></div> <ol> <li>Create a configuration file called <code>connect-distributed.properties</code> for the Kafka Connect framework with the following properties in it:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># A list of host/port pairs to use for establishing the initial connection to the Kafka cluster.</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=na>bootstrap.servers</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_BOOTSTRAP_URL</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=na>ssl.enabled.protocols</span><span class=o>=</span><span class=s>TLSv1.2</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=na>ssl.protocol</span><span class=o>=</span><span class=s>TLS</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=na>ssl.truststore.location</span><span class=o>=</span><span class=s>/opt/kafka/config/es-cert.p12</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=na>ssl.truststore.password</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_PKCS12_CERTIFICATE_PASSWORD</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=na>ssl.truststore.type</span><span class=o>=</span><span class=s>PKCS12</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=na>security.protocol</span><span class=o>=</span><span class=s>SASL_SSL</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=na>sasl.mechanism</span><span class=o>=</span><span class=s>SCRAM-SHA-512</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=na>sasl.jaas.config</span><span class=o>=</span><span class=s>org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;REPLACE_WITH_YOUR_SCRAM_USERNAME&quot; password=&quot;REPLACE_WITH_YOUR_SCRAM_PASSWORD&quot;;</span>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=c1># Consumer side configuration</span>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=na>consumer.bootstrap.servers</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_BOOTSTRAP_URL</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=na>consumer.security.protocol</span><span class=o>=</span><span class=s>SASL_SSL</span>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=na>consumer.ssl.protocol</span><span class=o>=</span><span class=s>TLSv1.2</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=na>consumer.ssl.truststore.location</span><span class=o>=</span><span class=s>/opt/kafka/config/es-cert.p12</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=na>consumer.ssl.truststore.password</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_PKCS12_CERTIFICATE_PASSWORD</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=na>consumer.ssl.truststore.type</span><span class=o>=</span><span class=s>PKCS12</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=na>consumer.sasl.mechanism</span><span class=o>=</span><span class=s>SCRAM-SHA-512</span>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=na>consumer.sasl.jaas.config</span><span class=o>=</span><span class=s>org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;REPLACE_WITH_YOUR_SCRAM_USERNAME&quot; password=&quot;REPLACE_WITH_YOUR_SCRAM_PASSWORD&quot;;</span>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=c1># Producer Side</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=na>producer.bootstrap.servers</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_BOOTSTRAP_URL</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=na>producer.security.protocol</span><span class=o>=</span><span class=s>SASL_SSL</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=na>producer.ssl.protocol</span><span class=o>=</span><span class=s>TLSv1.2</span>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=na>producer.ssl.truststore.location</span><span class=o>=</span><span class=s>/opt/kafka/config/es-cert.p12</span>
<a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=na>producer.ssl.truststore.password</span><span class=o>=</span><span class=s>REPLACE_WITH_YOUR_PKCS12_CERTIFICATE_PASSWORD</span>
<a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=na>producer.ssl.truststore.type</span><span class=o>=</span><span class=s>PKCS12</span>
<a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=na>producer.sasl.mechanism</span><span class=o>=</span><span class=s>SCRAM-SHA-512</span>
<a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=na>producer.sasl.jaas.config</span><span class=o>=</span><span class=s>org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;REPLACE_WITH_YOUR_SCRAM_USERNAME&quot; password=&quot;REPLACE_WITH_YOUR_SCRAM_PASSWORD&quot;;</span>
<a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a>
<a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=na>plugin.path</span><span class=o>=</span><span class=s>/opt/kafka/libs</span>
<a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a>
<a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a><span class=c1># unique name for the cluster, used in forming the Connect cluster group. Note that this must not conflict with consumer group IDs</span>
<a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a><span class=na>group.id</span><span class=o>=</span><span class=s>mq-sink-cluster-REPLACE_WITH_UNIQUE_IDENTIFIER</span>
<a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a>
<a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=c1># The converters specify the format of data in Kafka and how to translate it into Connect data. Every Connect user will</span>
<a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=c1># need to configure these based on the format they want their data in when loaded from or stored into Kafka</span>
<a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a><span class=na>key.converter</span><span class=o>=</span><span class=s>org.apache.kafka.connect.json.JsonConverter</span>
<a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a><span class=na>value.converter</span><span class=o>=</span><span class=s>org.apache.kafka.connect.json.JsonConverter</span>
<a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a><span class=c1># Converter-specific settings can be passed in by prefixing the Converter&#39;s setting with the converter we want to apply</span>
<a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a><span class=c1># it to</span>
<a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a><span class=na>key.converter.schemas.enable</span><span class=o>=</span><span class=s>true</span>
<a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a><span class=na>value.converter.schemas.enable</span><span class=o>=</span><span class=s>true</span>
<a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a>
<a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a><span class=c1># Topic to use for storing offsets.</span>
<a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a><span class=na>offset.storage.topic</span><span class=o>=</span><span class=s>connect-offsets-REPLACE_WITH_UNIQUE_IDENTIFIER</span>
<a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a><span class=na>offset.storage.replication.factor</span><span class=o>=</span><span class=s>3</span>
<a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a><span class=c1>#offset.storage.partitions=25</span>
<a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a>
<a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a><span class=c1># Topic to use for storing connector and task configurations; note that this should be a single partition, highly replicated, and compacted topic.</span>
<a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a><span class=na>config.storage.topic</span><span class=o>=</span><span class=s>connect-configs-REPLACE_WITH_UNIQUE_IDENTIFIER</span>
<a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a><span class=na>config.storage.replication.factor</span><span class=o>=</span><span class=s>3</span>
<a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a>
<a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a><span class=c1># Topic to use for storing statuses. This topic can have multiple partitions and should be replicated and compacted.</span>
<a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a><span class=na>status.storage.topic</span><span class=o>=</span><span class=s>connect-status-REPLACE_WITH_UNIQUE_IDENTIFIER</span>
<a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a><span class=na>status.storage.replication.factor</span><span class=o>=</span><span class=s>3</span>
<a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a><span class=na>status.storage.partitions</span><span class=o>=</span><span class=s>5</span>
<a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a>
<a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a><span class=c1># Flush much faster than normal, which is useful for testing/debugging</span>
<a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a><span class=na>offset.flush.interval.ms</span><span class=o>=</span><span class=s>10000</span>
</code></pre></div> <p><strong>IMPORTANT:</strong> You must replace <strong>all occurences</strong> of the following placeholders in the properties file above with the appropriate values for the Kafka Connect framework to work with your IBM Event Streams instance: * <code>REPLACE_WITH_YOUR_BOOTSTRAP_URL</code>: Your IBM Event Streams bootstrap url. * <code>REPLACE_WITH_YOUR_PKCS12_CERTIFICATE_PASSWORD</code>: Your PCKS12 TLS certificate password. * <code>REPLACE_WITH_YOUR_SCRAM_USERNAME</code>: Your SCRAM service credentials username. * <code>REPLACE_WITH_YOUR_SCRAM_PASSWORD</code>: Your SCRAM service credentials password. * <code>REPLACE_WITH_UNIQUE_IDENTIFIER</code>: A unique identifier so that the resources your kafka connect cluster will create on your IBM Event Streams instance don't collide with other users' resources <em>(Note: there are 4 placeholders of this type. Replace them all).</em> </p> <p>Review the <a href=/use-cases/overview/pre-requisites/ >Common pre-requisites</a> instructions if you don't know how to find out any of the config properties above. </p> <ol> <li> <p>Download the IBM Event Streams TLS certificate so that your Kafka Connect framework local instance can establish secure communication with your IBM Event Streams instance. <strong>IMPORTANT:</strong> download the PKCS12 certificate. How to get the certificate in the <a href=/use-cases/overview/pre-requisites/ >Common pre-requisites</a> section. </p> </li> <li> <p>Create a log4j configuration file named <code>connect-log4j.properties</code> based on the template below.</p> </li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=na>log4j.rootLogger</span><span class=o>=</span><span class=s>DEBUG, stdout</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=na>log4j.appender.stdout</span><span class=o>=</span><span class=s>org.apache.log4j.ConsoleAppender</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=na>log4j.appender.stdout.layout</span><span class=o>=</span><span class=s>org.apache.log4j.PatternLayout</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=na>log4j.appender.stdout.layout.ConversionPattern</span><span class=o>=</span><span class=s>[%d] %p %m (%c:%L)%n</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=na>log4j.logger.org.apache.kafka</span><span class=o>=</span><span class=s>INFO</span>
</code></pre></div> <ol> <li>Back out of the <code>config</code> directory to the <code>kafka-connect-mq-sink</code> directory:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=nb>cd</span><span class=w> </span>..
</code></pre></div> <ol> <li>Build the Docker image for your Kafka Connect framework that will contain the IBM MQ Sink connector and all the properties files you have created and tailored earlier so that your Kafka Connect framework can work with your IBM Event Streams instance we have set up previously in this exercise (<em>mind the dot at the end of the command. It is necessary</em>):</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>kafkaconnect-with-mq-sink:1.3.0<span class=w> </span>.
</code></pre></div> <ol> <li>Run the Kafka Connect MQ Sink container.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>docker run                                 \
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>  --name mq-sink                           \
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>  --detach                                 \
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>  --volume $(pwd)/config:/opt/kafka/config \
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>  --publish 8083:8083                      \
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>  --link mq:mq                             \
<a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>  kafkaconnect-with-mq-sink:1.3.0
</code></pre></div> <ol> <li>Now that we have a Kafka Connect framework running with the configuration to connect to our IBM Event Streams instance and the IBM MQ Sink Connector jar file in it, is to create a JSON file called <code>mq-sink.json</code> to startup an instance of the IBM MQ Sink connector in our Kafka Connect framework with the appropriate config to work read messages from the IBM Event Streams topic we desire and sink those to the IBM MQ instance we have running locally. <strong>IMPORTANT:</strong> If you are sharing your IBM Event Streams instance and followed the instructions on this readme, you should have appended a unique identifier to the name of the topic (<code>inventory</code>) that you are meant to create in IBM Event Streams. As a result, modify the line <code>"topics": "inventory"</code> in the following JSON object accordignly.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=p>{</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=w>   </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;mq-sink&quot;</span><span class=p>,</span>
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>   </span><span class=nt>&quot;config&quot;</span><span class=p>:</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>   </span><span class=p>{</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>       </span><span class=nt>&quot;connector.class&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.MQSinkConnector&quot;</span><span class=p>,</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=w>       </span><span class=nt>&quot;tasks.max&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=p>,</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>       </span><span class=nt>&quot;topics&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;inventory&quot;</span><span class=p>,</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>       </span><span class=nt>&quot;key.converter&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span class=p>,</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=w>       </span><span class=nt>&quot;value.converter&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span><span class=p>,</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>       </span><span class=nt>&quot;mq.queue.manager&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;QM1&quot;</span><span class=p>,</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>       </span><span class=nt>&quot;mq.connection.name.list&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;mq(1414)&quot;</span><span class=p>,</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=w>       </span><span class=nt>&quot;mq.user.name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;admin&quot;</span><span class=p>,</span>
<a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=w>       </span><span class=nt>&quot;mq.password&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;passw0rd&quot;</span><span class=p>,</span>
<a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=w>       </span><span class=nt>&quot;mq.user.authentication.mqcsp&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a><span class=w>       </span><span class=nt>&quot;mq.channel.name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;KAFKA.CHANNEL&quot;</span><span class=p>,</span>
<a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=w>       </span><span class=nt>&quot;mq.queue&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;INVENTORY&quot;</span><span class=p>,</span>
<a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>       </span><span class=nt>&quot;mq.message.builder&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder&quot;</span>
<a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>   </span><span class=p>}</span>
<a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=p>}</span>
</code></pre></div> <ol> <li>Last piece of the puzzle is to tell our Kafka Connect framework to create and startup the IBM MQ Sink connector based on the configuration we have in the previous json file. To do so, execute the following <code>POST</code> request.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span>http://localhost:8083/connectors<span class=w>   </span>--data<span class=w> </span><span class=s2>&quot;@./mq-sink.json&quot;</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=c1># The response returns the metadata about the connector</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=o>{</span><span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;mq-sink&quot;</span>,<span class=s2>&quot;config&quot;</span>:<span class=o>{</span><span class=s2>&quot;connector.class&quot;</span>:<span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.MQSinkConnector&quot;</span>,<span class=s2>&quot;tasks.max&quot;</span>:<span class=s2>&quot;1&quot;</span>,<span class=s2>&quot;topics&quot;</span>:<span class=s2>&quot;inventory&quot;</span>,<span class=s2>&quot;key.converter&quot;</span>:<span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span>,<span class=s2>&quot;value.converter&quot;</span>:<span class=s2>&quot;org.apache.kafka.connect.storage.StringConverter&quot;</span>,<span class=s2>&quot;mq.queue.manager&quot;</span>:<span class=s2>&quot;QM1&quot;</span>,<span class=s2>&quot;mq.connection.name.list&quot;</span>:<span class=s2>&quot;ibmmq(1414)&quot;</span>,<span class=s2>&quot;mq.user.name&quot;</span>:<span class=s2>&quot;admin&quot;</span>,<span class=s2>&quot;mq.password&quot;</span>:<span class=s2>&quot;passw0rd&quot;</span>,<span class=s2>&quot;mq.user.authentication.mqcsp&quot;</span>:<span class=s2>&quot;true&quot;</span>,<span class=s2>&quot;mq.channel.name&quot;</span>:<span class=s2>&quot;KAFKA.CHANNEL&quot;</span>,<span class=s2>&quot;mq.queue&quot;</span>:<span class=s2>&quot;INVENTORY&quot;</span>,<span class=s2>&quot;mq.message.builder&quot;</span>:<span class=s2>&quot;com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder&quot;</span>,<span class=s2>&quot;name&quot;</span>:<span class=s2>&quot;mq-sink&quot;</span><span class=o>}</span>,<span class=s2>&quot;tasks&quot;</span>:<span class=o>[{</span><span class=s2>&quot;connector&quot;</span>:<span class=s2>&quot;mq-sink&quot;</span>,<span class=s2>&quot;task&quot;</span>:0<span class=o>}]</span>,<span class=s2>&quot;type&quot;</span>:<span class=s2>&quot;sink&quot;</span><span class=o>}</span>
</code></pre></div> <ol> <li>You can query your Kafka Connect framework to make sure of this. Execute the following command that should return all the connectors up and running in your Kafka Connect cluster.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>curl<span class=w> </span>localhost:8083/connectors
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=o>[</span><span class=s2>&quot;mq-sink&quot;</span><span class=o>]</span>
</code></pre></div> <p>You should now have a working MQ Sink connector getting messages from your topic in IBM Event Streams and sending these to your local IBM MQ instance. In order to check that out working, we first need to send few messages to that IBM Event Streams topic and then check out our <code>INVENTORY</code> queue in our local IBM MQ instance.</p> <ol> <li>In order to send messages to IBM Event Streams, we are going to use the IBM Event Streams Starter application. You can find the instruction either in the IBM Event Streams official documentation [here] or on the IBM Event Streams dashboard:</li> </ol> <p><img alt=starter src=images/starter-app.png></p> <ol> <li>Follow the instructions to run the IBM Event Streams starter application from your workstation. <strong>IMPORTANT:</strong> When generating the properties for your IBM Event Streams starter application, please choose to connect to an existing topic and select the topic you created previously as part of this exercise so that the messages we send into IBM Event Streams end up in the appropriate topic that is being monitored by your IBM MQ Sink connector runnning on the Kafka Connect framework.</li> </ol> <p><img alt=starter-config src=images/starter-config.png></p> <ol> <li>Once you have your application running, open it up in your web browser, click on <code>Start producing</code>, let the application produce a couple of messages and then click on <code>Stop producing</code></li> </ol> <p><img alt=starter-messages src=images/starter-messages.png></p> <ol> <li>Check out your those messages got into the Kafka topic</li> </ol> <p><img alt=kafka-messages src=images/kafka-messages.png></p> <ol> <li>Check out your messages in the Kafka topic have already reached your <code>INVENTORY</code> queue in your local IBM MQ instance</li> </ol> <p><img alt=mq-messages src=images/mq-message.png></p> <ol> <li>You could also inspect the logs of your Kafka Connect Docker container running on your workstation:</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>docker<span class=w> </span>logs<span class=w> </span>mq-sink
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>...
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:17,110<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Putting<span class=w> </span>record<span class=w> </span><span class=k>for</span><span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:89<span class=o>)</span>
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:17,110<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Value<span class=w> </span>schema<span class=w> </span>Schema<span class=o>{</span>STRING<span class=o>}</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder:60<span class=o>)</span>
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:18,292<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Flushing<span class=w> </span>up<span class=w> </span>to<span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:110<span class=o>)</span>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:18,292<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>WorkerSinkTask<span class=o>{</span><span class=nv>id</span><span class=o>=</span>mq-sink-0<span class=o>}</span><span class=w> </span>Committing<span class=w> </span>offsets<span class=w> </span>asynchronously<span class=w> </span>using<span class=w> </span>sequence<span class=w> </span>number<span class=w> </span><span class=m>636</span>:<span class=w> </span><span class=o>{</span>inventory-0<span class=o>=</span>OffsetAndMetadata<span class=o>{</span><span class=nv>offset</span><span class=o>=</span><span class=m>1</span>,<span class=w> </span><span class=nv>leaderEpoch</span><span class=o>=</span>null,<span class=w> </span><span class=nv>metadata</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=o>}}</span><span class=w> </span><span class=o>(</span>org.apache.kafka.connect.runtime.WorkerSinkTask:346<span class=o>)</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:18,711<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Putting<span class=w> </span>record<span class=w> </span><span class=k>for</span><span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:89<span class=o>)</span>
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:18,711<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Value<span class=w> </span>schema<span class=w> </span>Schema<span class=o>{</span>STRING<span class=o>}</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder:60<span class=o>)</span>
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:20,674<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Putting<span class=w> </span>record<span class=w> </span><span class=k>for</span><span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>2</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:89<span class=o>)</span>
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:20,675<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Value<span class=w> </span>schema<span class=w> </span>Schema<span class=o>{</span>STRING<span class=o>}</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder:60<span class=o>)</span>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:28,293<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Flushing<span class=w> </span>up<span class=w> </span>to<span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>3</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:110<span class=o>)</span>
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:28,293<span class=o>]</span><span class=w> </span>INFO<span class=w> </span>WorkerSinkTask<span class=o>{</span><span class=nv>id</span><span class=o>=</span>mq-sink-0<span class=o>}</span><span class=w> </span>Committing<span class=w> </span>offsets<span class=w> </span>asynchronously<span class=w> </span>using<span class=w> </span>sequence<span class=w> </span>number<span class=w> </span><span class=m>637</span>:<span class=w> </span><span class=o>{</span>inventory-0<span class=o>=</span>OffsetAndMetadata<span class=o>{</span><span class=nv>offset</span><span class=o>=</span><span class=m>3</span>,<span class=w> </span><span class=nv>leaderEpoch</span><span class=o>=</span>null,<span class=w> </span><span class=nv>metadata</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=o>}}</span><span class=w> </span><span class=o>(</span>org.apache.kafka.connect.runtime.WorkerSinkTask:346<span class=o>)</span>
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=o>[</span><span class=m>2021</span>-01-19<span class=w> </span><span class=m>19</span>:44:38,296<span class=o>]</span><span class=w> </span>DEBUG<span class=w> </span>Flushing<span class=w> </span>up<span class=w> </span>to<span class=w> </span>topic<span class=w> </span>inventory,<span class=w> </span>partition<span class=w> </span><span class=m>0</span><span class=w> </span>and<span class=w> </span>offset<span class=w> </span><span class=m>3</span><span class=w> </span><span class=o>(</span>com.ibm.eventstreams.connect.mqsink.MQSinkTask:110<span class=o>)</span>
</code></pre></div> <p>To cleanup your environment, you can do</p> <ol> <li>Remove the connector from your Kafka Connect framework instance (this isn't really needed if you are going to stop and remove the Kafka Connect Docker container)</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>curl<span class=w> </span>-X<span class=w> </span>DELETE<span class=w> </span>http://localhost:8083/connectors/mq-sink
</code></pre></div> <ol> <li>Stop both IBM MQ and Kakfa Connect Docker containers running on your workstation</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a>docker<span class=w> </span>stop<span class=w> </span>mq<span class=w> </span>mq-sink
</code></pre></div> <ol> <li>Remove both IBM MQ and Kakfa Connect Docker containers from your workstation</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a>docker<span class=w> </span>rm<span class=w> </span>mq<span class=w> </span>mq-sink
</code></pre></div> <h2 id=lab-4-mq-connector-with-kafka-confluent>Lab 4: MQ Connector with Kafka Confluent<a class=headerlink href=#lab-4-mq-connector-with-kafka-confluent title="Permanent link">&para;</a></h2> <ul> <li>Clone the git <code>ibm-cloud-architecture/eda-lab-mq-to-kafka</code> repository and follow the readme.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>git<span class=w> </span>clone<span class=w> </span>https://github.com/ibm-cloud-architecture/eda-lab-mq-to-kafka
</code></pre></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2022 IBM </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ibm-cloud-architecture target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/agileitarchitecture target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.1e8ae164.min.js></script> </body> </html>